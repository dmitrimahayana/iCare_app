<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>iCare Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/bootstrap-responsive.min.css" rel="stylesheet">
<link href="http://fonts.googleapis.com/css?family=Open+Sans:400italic,600italic,400,600"
        rel="stylesheet">
<link href="css/font-awesome.css" rel="stylesheet">
<link href="css/style.css" rel="stylesheet">
<link href="css/pages/dashboard.css" rel="stylesheet">
<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
<!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body>
<div class="navbar navbar-fixed-top">
  <div class="navbar-inner">
    <div class="container"> <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"><span
                    class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span> </a><a class="brand" href="index.html">iCare</a>
      <div class="nav-collapse">
        <ul class="nav pull-right">
          <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"><i
                            class="icon-cog"></i> Akun <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li><a href="javascript:;location.href='profil.html';">Profil</a></li>
              <li><a href="javascript:;">Help</a></li>
              <li><a href="javascript:getLogOut();">Logout</a></li>
            </ul>
          </li>
        </ul>
      </div>
      <!--/.nav-collapse --> 
    </div>
    <!-- /container --> 
  </div>
  <!-- /navbar-inner --> 
</div>
<!-- /navbar -->

<div class="subnavbar">
  <div class="subnavbar-inner">
    <div class="container">
      <ul class="mainnav">
        <li><a href="index.html"><i class="icon-home"></i><span>Aktivitas</span></a></li>
        <li class="active"><a href="siswa_dashboard.html"><i class="icon-list-alt"></i><span>Siswa</span></a></li>
        <li><a href="progress.html"><i class="icon-bar-chart"></i><span>Progress</span></a></li>
      </ul>
    </div>
    <!-- /container --> 
  </div>
  <!-- /subnavbar-inner --> 
</div>
<!-- /subnavbar -->

<div class="main">
  <div class="main-inner">
    <div class="container">
      <div class="row">
      
        <div class="span12">

          <div class="widget">
              <a id="backPage" class="btn btn-large btn-invert" href="siswa_dashboard.html" ><i class="btn-icon-only icon-chevron-left"></i> Kembali</a>
          </div>
          <!-- /widget -->

          <div class="widget">
            <div class="widget-header"> <i class="icon-th-list"></i>
              <h3 id="nameH3">Aktivitas</h3>
            </div>
            <!-- /widget-header -->
            <div class="widget-content">
                <ul class="news-items">
                <li>
                <div class="news-item-date"> <span class="news-item-day"></div>
                <div class="news-item-detail"> <h1 id="nameH1"><a style="color:black;"></a></h1>
                    <p style="" class="news-item-preview"> 
                    <img id="ava_picture" width="120px" height="120px" alt="ava_default" src="img/ava_default.jpg" /></span>
                    <table id="resultSiswa" class="table table-striped table-bordered">
                        
                    </table>
                    <button class="checkEdit btn btn-primary" onclick="location.href='edit_profil_siswa.html';"><i class="btn-icon-only icon-cog"></i> Ubah Konfigurasi</button> <br/><br/>
                    <div class="control-group">
        						  <div class="controls">
        								<div class="accordion" id="accordion2">

                            <div class="accordion-group">
                              <div class="accordion-heading">
                                  <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseOne">
                                  Klik untuk melihat daftar aktivitas siswa
                                  </a>
                              </div>
                              <div id="collapseOne" class="accordion-body collapse out">
                                  <div class="accordion-inner">
                                  <table id="resultData" class="table table-striped ">
                                      
                                  </table>
                                  </div>
                              </div>
                            </div>

                        </div>
          						</div> <!-- /controls -->	
          					</div> <!-- /control-group -->
                        <button class="btn btn-success" onclick="startTest()"><i class="btn-icon-only icon-play-circle"></i> Mulai Aktivitas Sekarang</button>
                    </p>
                </div> 
                </li>
            </div>
            <!-- /widget-content --> 
          </div>
          <!-- /widget --> 
          
        </div>
        <!-- /span12 --> 
      </div>
      <!-- /row --> 
    </div>
    <!-- /container --> 
  </div>
  <!-- /main-inner --> 
</div>

<!-- Le javascript
================================================== --> 
<!-- Placed at the end of the document so the pages load faster --> 
<script src="js/jquery-1.7.2.min.js"></script> 
<script src="js/excanvas.min.js"></script> 
<script src="js/bootstrap.js"></script>
<script language="javascript" type="text/javascript" src="js/full-calendar/fullcalendar.min.js"></script>
 
<script src="js/base.js"></script> 

<script type="text/javascript" src="js/model/siswa_model.js"></script>
<script type="text/javascript" src="js/model/aktivitas_model.js"></script>
<script type="text/javascript" src="js/model/rangkaian_aktivitas_model.js"></script>
<script type="text/javascript" src="js/model/test_siswa_model.js"></script>
<script>
  function getLogOut(){
    localStorage.removeItem('isLogin');
    localStorage.removeItem('id_user_login');
    localStorage.removeItem('index_table');
    localStorage.removeItem('is_terapist');
    location.href='login.html';
  }

  function redirectPage(url, id){
    localStorage.setItem("id_siswa_url", id);
    location.href=url;
  }

  function redirectPageTest(url, id, id_aktivitas, number, test, id_date){
    localStorage.setItem("id_siswa_url", id);
    localStorage.setItem("id_aktivitas_url", id_aktivitas);
    localStorage.setItem("number_url", number);
    localStorage.setItem("test", test);
    localStorage.setItem("id_date", id_date);
    location.href=url;
  }

  var id = localStorage.getItem("id_siswa_url");

  $("#backPage").attr("href", "javascript:redirectPage('siswa_dashboard.html', id)");
  $(".checkEdit").attr("onclick", "redirectPage('edit_profil_siswa.html', "+id+")");

  var dummy= getSomeSiswa(id, 'id_siswa');
  if(dummy!=null || dummy!=''){
    
    if(dummy[0].pertanyaan=="suara_teks"){
        localStorage.setItem("is_sound", 'suara_teks');
    }
    else if(dummy[0].pertanyaan=="suara"){
        localStorage.setItem("is_sound", 'suara');
    }
    else if(dummy[0].pertanyaan=="teks"){
        localStorage.setItem("is_sound", 'teks');
    }

    $('#ava_picture').attr("src",dummy[0].photo_siswa);
    $( "#nameH3" ).html( 'Aktivitas '+dummy[0].nama_siswa );
      $("#resultSiswa").append(
        "<tr>"+
            "<td>Informasi Pertanyaan</td>"+
            "<td>"+dummy[0].pertanyaan+"</td>"+
        "</tr>"+
        "<tr>"+
            "<td>Jenis Tulisan</td>"+
            "<td>"+dummy[0].font+"</td>"+
        "</tr>"+
        "<tr>"+
            "<td>Tingkat Kesulitan</td>"+
            "<td>"+dummy[0].kesulitan+"</td>"+
        "</tr>"); 

    $( "#nameH3" ).text( 'Aktivitas '+' '+dummy[0].nama_siswa );
    $( "#nameH1" ).text( dummy[0].nama_siswa.toUpperCase() );
  }

  var countNumberLine= 0;
  filterJenis();

  function getListByJenis(tipeAktivitas){
    var dummy3= getSomeAnyParamRangkaianAktivitas(id, '1', 'id_siswa', 'is_active');
    if(dummy3!=null || dummy3!=''){
        for(var i=0; i<dummy3.length; i++){
          var dummy2=  getSomeAktivitas(dummy3[i].id_aktivitas, 'id_aktivitas');
          var type_aktivitas=dummy2[0].link_aktivitas.split('_');
          if(type_aktivitas[0].split(".h")[1])
            type_aktivitas[0]= type_aktivitas[0].split(".h")[0];
          else 
            type_aktivitas[0]= type_aktivitas[0];
        
          if(type_aktivitas[0]==tipeAktivitas){
            countNumberLine= countNumberLine+1;
            $("#resultData").append(
              "<tr>"+
                "<td>"+countNumberLine+"</td>"+
                "<td>"+dummy2[0].nama_Aktivitas+"</td>"+
              "</tr>"); 
          }
      }
    }
  }
    
  function filterJenis(){
    var dummy2 = getSomeAnyParamRangkaianAktivitas(id, "1", 'id_siswa', 'is_active')
    var temp_aktivitas= [];
    var jenis= new Array();
    jenis[0]= 'bahasa';
    jenis[1]= 'angka';
    jenis[2]= 'lingkungan';
    jenis[3]= 'mandiri';
    jenis[4]= 'sosial';
    jenis[5]= 'puzzle';
    for (var j = 0; j < dummy2.length; j++) {
        var dummy3 = getSomeAktivitas(dummy2[j].id_aktivitas, 'id_aktivitas');
        var type_aktivitas=dummy3[0].link_aktivitas.split('_');
        if(type_aktivitas[0].split(".h")[1])
          type_aktivitas[0]= type_aktivitas[0].split(".h")[0];
        else 
          type_aktivitas[0]= type_aktivitas[0];
        
        switch (type_aktivitas[0]){
          case jenis[0]:
            temp_aktivitas[0]= 1;
            break;
          case jenis[1]:
            temp_aktivitas[1]= 1;
            break;
          case jenis[2]:
            temp_aktivitas[2]= 1;
            break;
          case jenis[3]:
            temp_aktivitas[3]= 1;
            break;
          case jenis[4]:
            temp_aktivitas[4]= 1;
            break;
          case jenis[5]:
            temp_aktivitas[5]= 1;
            break;
        }
    }

    for(var j=0; j<6; j++){
      if(temp_aktivitas[j]){
        getListByJenis(jenis[j]);
      }
    }
  }

  var dataTest= [];
  var countData= 0;
  function getListByJenis2(tipeAktivitas){
    var dummy3= getSomeAnyParamRangkaianAktivitas(id, '1', 'id_siswa', 'is_active');
    if(dummy3!=null || dummy3!=''){
        for(var i=0; i<dummy3.length; i++){
          var dummy2=  getSomeAktivitas(dummy3[i].id_aktivitas, 'id_aktivitas');
          var type_aktivitas=dummy2[0].link_aktivitas.split('_');
          if(type_aktivitas[0].split(".h")[1])
            type_aktivitas[0]= type_aktivitas[0].split(".h")[0];
          else 
            type_aktivitas[0]= type_aktivitas[0];
        
          if(type_aktivitas[0]==tipeAktivitas){
            countNumberLine= countNumberLine+1;
            var temp = JSON.stringify({
              id_aktivitas : dummy3[i].id_aktivitas
            });
            console.log(dummy2[0].link_aktivitas);
            dataTest[countData]= temp;
            countData++;
            // dataTest.push(temp);
            // console.log(temp.id_siswa);
            // console.log("==>"+countNumberLine+" "+dummy3[i].id_aktivitas+" "+id+" "+dummy2[0].nama_Aktivitas);
          }
      }
      return dataTest;
    }
  }

  function getDateNowTest(){
    var d = new Date();
    var curr_date = d.getDate();
    var curr_month = d.getMonth() + 1; //Months are zero based
    var curr_year = d.getFullYear();
    return curr_date+"_"+curr_month+"_"+curr_year;
  }

  function filterJenis2(execute){
    var dummy2 = getSomeAnyParamRangkaianAktivitas(id, "1", 'id_siswa', 'is_active')
    var temp_aktivitas= [];
    var jenis= new Array();
    jenis[0]= 'bahasa';
    jenis[1]= 'angka';
    jenis[2]= 'lingkungan';
    jenis[3]= 'mandiri';
    jenis[4]= 'sosial';
    jenis[5]= 'puzzle';
    for (var j = 0; j < dummy2.length; j++) {
        var dummy3 = getSomeAktivitas(dummy2[j].id_aktivitas, 'id_aktivitas');
        var type_aktivitas=dummy3[0].link_aktivitas.split('_');
        if(type_aktivitas[0].split(".h")[1])
          type_aktivitas[0]= type_aktivitas[0].split(".h")[0];
        else 
          type_aktivitas[0]= type_aktivitas[0];
        
        switch (type_aktivitas[0]){
          case jenis[0]:
            temp_aktivitas[0]= 1;
            break;
          case jenis[1]:
            temp_aktivitas[1]= 1;
            break;
          case jenis[2]:
            temp_aktivitas[2]= 1;
            break;
          case jenis[3]:
            temp_aktivitas[3]= 1;
            break;
          case jenis[4]:
            temp_aktivitas[4]= 1;
            break;
          case jenis[5]:
            temp_aktivitas[5]= 1;
            break;
        }
    }

    for(var j=0; j<6; j++){
      if(temp_aktivitas[j]){
        getListByJenis2(jenis[j]);
      }
    }

    var finalRess= JSON.stringify({
      id_test : getDateNowTest(),
      id_siswa : id,
      list_rangkaian : dataTest
    });

    /*print id aktivitas*/
    // var test= JSON.parse(finalRess);
    // for(var j=0; j<test.list_rangkaian.length; j++){
    //   var ress= JSON.parse(test.list_rangkaian[j]);
    //   console.log(j+" "+test.id_test+" "+test.id_siswa+" "+ress.id_aktivitas);
    // }

    if(execute=="add"){
      console.log(finalRess);
      addDataTestSiswa(finalRess);
      countData= 0;
      return true;
    }
    else if(execute=="edit"){
      console.log('edit');
      console.log(finalRess);
      countData= 0;
      return finalRess;
    }
    
  }

  // deleteAllTestSiswa(); //delete All
  
  function startTest(){
    countNumberLine= 0;
    var testNow= getSomeAnyParamTestSiswa(getDateNowTest(), id, 'id_test', 'id_siswa');
    if(testNow){
      var r=confirm("Mulai test sekarang?");
      if (r==true){
        console.log("sudah ada ini");
        var dataEdit= filterJenis2('edit');
        if(editDataTestSiswa(testNow[0].index_table, dataEdit)){
          testNow= getSomeAnyParamTestSiswa(getDateNowTest(), id, 'id_test', 'id_siswa');
        }
        var j= 0; //first aktivitas
        var ress= JSON.parse(testNow[0].list_rangkaian[j]);
        console.log("ress: "+testNow[0].id_test+" "+testNow[0].id_siswa+" "+ress.id_aktivitas);
        var ressDetail=  getSomeAktivitas(ress.id_aktivitas, 'id_aktivitas');
        console.log("link: "+ressDetail[0].link_aktivitas+" OK");
        redirectPageTest('aktivities/'+ressDetail[0].link_aktivitas, id, ress.id_aktivitas, j, 'test', getDateNowTest())
      }
      else{
      // x="You pressed Cancel!";
      } 
      
    }
    else {
      console.log("tidak ada, buat baru");
      filterJenis2('add');
      startTest();
    }
  }

</script>
</body>
</html>
